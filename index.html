spinButton.onclick = function() {
    // Вращение колеса
    let randomDegree = Math.floor(Math.random() * 360); // Случайный угол для вращения
    let actualRotation = randomDegree + 3600; // Добавляем несколько оборотов для эффекта

    // Поворачиваем колесо
    wheel.style.transition = "transform 3s ease-out";
    wheel.style.transform = `rotate(${actualRotation}deg)`;

    // После завершения вращения, показываем результат
    setTimeout(function() {
        let prizeIndex = Math.floor((randomDegree % 360) / anglePerSector);
        let prize = prizes[prizeIndex];
        resultDiv.textContent = `Вы выиграли: ${prize.name} (${prize.amount} звёзд)`;

        // Получаем telegram_id и отправляем результат вращения на сервер
        const telegramId = window.Telegram.WebApp.user.id;  // Получаем ID пользователя

        // Логируем, чтобы проверить, что запрос отправляется
        console.log(`Отправка запроса на сервер с данными:`, {
            amount: prize.amount,
            telegram_id: telegramId
        });

        // Отправляем запрос на сервер
        fetch("http://127.0.0.1:8000/update_balance", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                amount: prize.amount,
                telegram_id: telegramId
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log('Ответ от сервера:', data);
        })
        .catch(error => {
            console.error('Ошибка при отправке запроса:', error);
        });

        // Отправляем результат в WebApp API (необязательно)
        window.Telegram.WebApp.sendData(`spin_result:${prize.amount}`);
    }, 3000);
};
